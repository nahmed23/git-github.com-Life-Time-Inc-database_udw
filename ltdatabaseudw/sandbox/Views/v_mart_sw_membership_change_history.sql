CREATE VIEW [sandbox].[v_mart_sw_membership_change_history]
AS SELECT MbrsNew.[membership_id]
       , [created_date_no_time]                  = MbrsNew.[created_date_no_time]
       , [created_date_time]                     = MbrsNew.[created_date_time]
       , [new_club_id]                           = MbrsNew.[club_id]
       , [new_advisor_employee_id]               = MbrsNew.[advisor_employee_id]
       , [new_company_id]                        = MbrsNew.[company_id]
       , [new_membership_type_id]                = MbrsNew.[membership_type_id]
       , [new_val_enrollment_type_id]            = MbrsNew.[val_enrollment_type_id]
       , [new_val_membership_source_id]          = MbrsNew.[val_membership_source_id]
       , [new_val_membership_status_id]          = MbrsNew.[val_membership_status_id]
       , [new_val_termination_reason_id]         = MbrsNew.[val_termination_reason_id]
       , [new_current_price]                     = MbrsNew.[current_price]
       , [new_undiscounted_price]                = MbrsNew.[undiscounted_price]
       , [new_activation_date_no_time]           = MbrsNew.[activation_date_no_time]
       , [new_activation_date]                   = MbrsNew.[activation_date]
       , [new_cancellation_request_date_no_time] = MbrsNew.[cancellation_request_date_no_time]
       , [new_cancellation_request_date]         = MbrsNew.[cancellation_request_date]
       , [new_expiration_date_no_time]           = MbrsNew.[expiration_date_no_time]
       , [new_expiration_date]                   = MbrsNew.[expiration_date]
       , [new_effective_date_no_time]            = MbrsNew.[effective_date_no_time]
       , [new_effective_date_time]               = MbrsNew.[effective_date_time]
       , [old_club_id]                           = MbrsOld.[club_id]
       , [old_advisor_employee_id]               = MbrsOld.[advisor_employee_id]
       , [old_company_id]                        = MbrsOld.[company_id]
       , [old_membership_type_id]                = MbrsOld.[membership_type_id]
       , [old_val_enrollment_type_id]            = MbrsOld.[val_enrollment_type_id]
       , [old_val_membership_source_id]          = MbrsOld.[val_membership_source_id]
       , [old_val_membership_status_id]          = MbrsOld.[val_membership_status_id]
       , [old_val_termination_reason_id]         = MbrsOld.[val_termination_reason_id]
       , [old_current_price]                     = MbrsOld.[current_price]
       , [old_undiscounted_price]                = MbrsOld.[undiscounted_price]
       , [old_activation_date_no_time]           = MbrsOld.[activation_date_no_time]
       , [old_activation_date]                   = MbrsOld.[activation_date]
       , [old_cancellation_request_date_no_time] = MbrsOld.[cancellation_request_date_no_time]
       , [old_cancellation_request_date]         = MbrsOld.[cancellation_request_date]
       , [old_expiration_date_no_time]           = MbrsOld.[expiration_date_no_time]
       , [old_expiration_date]                   = MbrsOld.[expiration_date]
       , [old_effective_date_no_time]            = MbrsOld.[effective_date_no_time]
       , [old_effective_date_time]               = MbrsOld.[effective_date_time]
       , MbrsNew.[dim_mms_membership_key]
       , [dim_new_club_key]                      = MbrsNew.[dim_club_key]
       , [dim_new_advisor_employee_key]          = MbrsNew.[dim_advisor_employee_key]
       , [dim_new_company_key]                   = MbrsNew.[dim_mms_company_key]
       , [dim_new_membership_type_key]           = MbrsNew.[dim_mms_membership_type_key]
       , [dim_old_club_key]                      = MbrsOld.[dim_club_key]
       , [dim_old_advisor_employee_key]          = MbrsOld.[dim_advisor_employee_key]
       , [dim_old_company_key]                   = MbrsOld.[dim_mms_company_key]
       , [dim_old_membership_type_key]           = MbrsOld.[dim_mms_membership_type_key]
    FROM [sandbox].[v_mart_mms_membership_history] MbrsNew
         INNER JOIN [sandbox].[v_mart_mms_membership_history] MbrsOld
           ON MbrsOld.[membership_id] = MbrsNew.[membership_id]
    WHERE MbrsOld.[effective_date_time] < MbrsNew.[effective_date_time];